<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Scroll of Seven Seals - Simple Multiplayer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Uncial+Antiqua&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cinzel', serif;
            background: linear-gradient(135deg, #2c1810, #4a3425, #6b4d37);
            color: #f4f1e8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #d4af37;
        }
        
        .title {
            font-family: 'Uncial Antiqua', cursive;
            font-size: 2.5em;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
        }
        
        .game-mode {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #8b7355;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .mode-card:hover {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }
        
        .mode-card h3 {
            color: #d4af37;
            margin-bottom: 10px;
        }
        
        .team-setup {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #8b7355;
            margin-bottom: 20px;
            display: none;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #d4af37;
            font-weight: 600;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #8b7355;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.3);
            color: #f4f1e8;
            font-family: 'Cinzel', serif;
        }
        
        .btn {
            background: linear-gradient(145deg, #d4af37, #b8941f);
            color: #2c1810;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .btn:hover {
            background: linear-gradient(145deg, #e6c757, #d4af37);
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none;
        }
        
        .share-link {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid #d4af37;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
        }
        
        .lobby-team {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #8b7355;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .lobby-team.host {
            border-color: #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            background: rgba(34, 139, 34, 0.3);
            color: #90ee90;
        }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 20px;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .timer {
            font-family: monospace;
            font-size: 1.5em;
            color: #d4af37;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #d4af37;
        }
        
        .progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid #8b7355;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #e6c757);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .seals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .seal {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            border: 2px solid #8b7355;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .seal:hover {
            border-color: #d4af37;
            transform: translateY(-2px);
        }
        
        .seal.completed {
            border-color: #228b22;
            background: linear-gradient(145deg, rgba(34, 139, 34, 0.3), rgba(34, 139, 34, 0.1));
        }
        
        .seal.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .seal-number {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #d4af37;
            color: #2c1810;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .seal-title {
            font-size: 1.3em;
            color: #d4af37;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .leaderboard {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #8b7355;
            margin-bottom: 20px;
            display: none;
        }
        
        .leaderboard h3 {
            color: #d4af37;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .team-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid #8b7355;
        }
        
        .team-entry.first { border-left-color: #ffd700; }
        .team-entry.second { border-left-color: #c0c0c0; }
        .team-entry.third { border-left-color: #cd7f32; }
        
        .final-challenge {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
            display: none;
        }
        
        .instructions {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid #d4af37;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        @media (max-width: 768px) {
            .game-mode {
                grid-template-columns: 1fr;
            }
            
            .game-info {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">üîÆ The Scroll of Seven Seals</h1>
            <p>Simple Multiplayer Bible Mystery Adventure</p>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h4>üåê How Multiplayer Works (Simple Method):</h4>
            <p><strong>1.</strong> Create a room ‚Üí Get a shareable link<br>
            <strong>2.</strong> Send the link to friends via text/email<br>
            <strong>3.</strong> Everyone opens the same link to join<br>
            <strong>4.</strong> Progress syncs automatically via URL updates!</p>
        </div>

        <!-- Game Mode Selection -->
        <div id="modeSelection" class="game-mode">
            <div class="mode-card" onclick="selectMode('single')">
                <h3>üè† Single Group</h3>
                <p>Play as one team and beat your best time</p>
            </div>
            <div class="mode-card" onclick="selectMode('multi')">
                <h3>ü§ñ vs Computer Teams</h3>
                <p>Compete against AI opponents</p>
            </div>
            <div class="mode-card" onclick="selectMode('room')">
                <h3>üåê Simple Multiplayer</h3>
                <p>Share a link to compete with friends</p>
            </div>
        </div>

        <!-- Team Setup -->
        <div id="teamSetup" class="team-setup">
            <h3 id="setupTitle">Team Setup</h3>
            <div class="input-group">
                <label for="teamName">Team Name:</label>
                <input type="text" id="teamName" placeholder="Enter your team name">
            </div>
            
            <div id="multiSetup" class="hidden">
                <div class="input-group">
                    <label for="numTeams">Number of Teams:</label>
                    <select id="numTeams">
                        <option value="2">2 teams</option>
                        <option value="3">3 teams</option>
                        <option value="4">4 teams</option>
                        <option value="5">5 teams</option>
                        <option value="6">6 teams</option>
                    </select>
                </div>
            </div>
            
            <div id="roomSetup" class="hidden">
                <div class="input-group">
                    <label>Choose an option:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 10px 0;">
                        <button class="btn" onclick="createRoom()">üèóÔ∏è Create Room</button>
                        <button class="btn" onclick="showJoinRoom()">üîó Join via Link</button>
                    </div>
                </div>
                <div id="joinRoomDiv" class="hidden">
                    <p>Or paste a room link from a friend:</p>
                    <div class="input-group">
                        <input type="text" id="roomLink" placeholder="Paste room link here">
                    </div>
                    <button class="btn" onclick="joinViaLink()">Join Room</button>
                </div>
            </div>
            
            <button class="btn" onclick="startGame()">Start Adventure</button>
            <button class="btn" onclick="goBack()" style="background: #8b7355;">‚Üê Back</button>
        </div>

        <!-- Room Lobby -->
        <div id="roomLobby" class="hidden">
            <div class="header">
                <h2 id="lobbyTitle">Game Room</h2>
                <div id="roomInfo" style="margin-top: 15px;">
                    <div class="share-link">
                        <strong>üì± Share this link with your friends:</strong><br>
                        <span id="shareLink" style="font-family: monospace; font-size: 0.9em;"></span><br>
                        <button class="btn" onclick="copyShareLink()" style="margin-top: 10px; padding: 5px 10px;">üìã Copy Link</button>
                    </div>
                </div>
            </div>
            
            <div style="background: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px; border: 1px solid #8b7355;">
                <h3 style="color: #d4af37; text-align: center; margin-bottom: 20px;">
                    Teams in Lobby (<span id="teamCount">0</span>/6)
                </h3>
                <div id="lobbyTeams"></div>
                
                <div style="text-align: center; padding-top: 15px; border-top: 1px solid #8b7355;">
                    <div id="hostControls" class="hidden">
                        <button class="btn" id="startRoomGame" onclick="startRoomGame()" disabled>üöÄ Start Game</button>
                        <p style="margin: 10px 0; font-size: 0.9em; opacity: 0.8;">Need at least 2 teams to start</p>
                    </div>
                    <button class="btn" onclick="leaveRoom()" style="background: #dc3545;">üö™ Leave Room</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <!-- Game Info Bar -->
            <div class="game-info">
                <div>
                    <strong id="currentTeam">Team Name</strong>
                    <div id="gameMode">Game Mode</div>
                </div>
                <div class="timer" id="timer">00:00</div>
                <button class="btn" onclick="resetGame()" style="background: #dc3545;">Reset Game</button>
            </div>

            <!-- Leaderboard -->
            <div id="leaderboard" class="leaderboard">
                <h3>üèÜ Live Leaderboard</h3>
                <div id="leaderboardContent"></div>
            </div>

            <!-- Progress Bar -->
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div style="text-align: center; margin: 10px 0;">
                <span id="progressText">0/7 Seals Broken</span>
            </div>

            <!-- Seals Grid -->
            <div class="seals-grid" id="sealsGrid"></div>

            <!-- Final Challenge -->
            <div id="finalChallenge" class="final-challenge">
                <h2>üéâ Final Challenge Complete!</h2>
                <div id="victoryMessage"></div>
                <button class="btn" onclick="resetGame()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            mode: '',
            currentTeam: '',
            teams: [],
            completedSeals: [],
            startTime: null,
            currentPuzzle: null,
            isGameActive: false,
            roomId: '',
            isHost: false,
            syncInterval: null
        };

        // Seal Data
        const seals = [
            { id: 1, title: "The Garden Cipher", description: "Arrange Genesis creation events in order", unlock: [] },
            { id: 2, title: "The Blood Trail", description: "Answer questions about biblical sacrifices", unlock: [1] },
            { id: 3, title: "The Prophecy Scroll", description: "Match prophecies with fulfillments", unlock: [2] },
            { id: 4, title: "The Parable Labyrinth", description: "Navigate Jesus' teachings", unlock: [3] },
            { id: 5, title: "The Upper Room", description: "Solve the Last Supper mystery", unlock: [4] },
            { id: 6, title: "The Church Underground", description: "Decode apostolic messages", unlock: [5] },
            { id: 7, title: "The Apocalypse Map", description: "Interpret Revelation symbols", unlock: [6] }
        ];

        // Utility Functions
        function generateRoomId() {
            return Math.random().toString(36).substring(2, 12);
        }

        function formatTime(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // URL-based multiplayer sync
        function saveGameState() {
            const stateData = {
                room: gameState.roomId,
                teams: gameState.teams,
                status: gameState.isGameActive ? 'playing' : 'waiting',
                host: gameState.isHost ? gameState.currentTeam : null,
                started: gameState.startTime
            };
            
            localStorage.setItem(`room_${gameState.roomId}`, JSON.stringify(stateData));
        }

        function loadGameState(roomId) {
            const saved = localStorage.getItem(`room_${roomId}`);
            return saved ? JSON.parse(saved) : null;
        }

        function updateTeamProgress() {
            if (gameState.mode === 'room' && gameState.roomId) {
                const roomData = loadGameState(gameState.roomId);
                if (roomData && roomData.teams) {
                    // Update current team's progress
                    const teamIndex = roomData.teams.findIndex(t => t.name === gameState.currentTeam);
                    if (teamIndex >= 0) {
                        roomData.teams[teamIndex] = {
                            ...roomData.teams[teamIndex],
                            seals: gameState.completedSeals.length,
                            time: Date.now() - gameState.startTime,
                            finished: gameState.completedSeals.length === 7
                        };
                        
                        localStorage.setItem(`room_${gameState.roomId}`, JSON.stringify(roomData));
                        updateLeaderboard(roomData.teams);
                    }
                }
            }
        }

        function syncWithRoom() {
            if (gameState.mode === 'room' && gameState.roomId) {
                const roomData = loadGameState(gameState.roomId);
                if (roomData) {
                    // Check if game started
                    if (roomData.status === 'playing' && !gameState.isGameActive) {
                        startRoomGameplay();
                    }
                    
                    // Update leaderboard
                    if (gameState.isGameActive && roomData.teams) {
                        updateLeaderboard(roomData.teams);
                    }
                    
                    // Update lobby
                    if (!gameState.isGameActive) {
                        updateLobby(roomData);
                    }
                }
            }
        }

        // Game Mode Selection
        function selectMode(mode) {
            gameState.mode = mode;
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('teamSetup').style.display = 'block';
            
            // Hide all setup sections first
            document.getElementById('multiSetup').classList.add('hidden');
            document.getElementById('roomSetup').classList.add('hidden');
            
            if (mode === 'single') {
                document.getElementById('setupTitle').textContent = 'Single Group Setup';
            } else if (mode === 'multi') {
                document.getElementById('setupTitle').textContent = 'vs Computer Teams Setup';
                document.getElementById('multiSetup').classList.remove('hidden');
            } else if (mode === 'room') {
                document.getElementById('setupTitle').textContent = 'Simple Multiplayer Setup';
                document.getElementById('roomSetup').classList.remove('hidden');
            }
        }

        function goBack() {
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('teamSetup').style.display = 'none';
            document.getElementById('joinRoomDiv').classList.add('hidden');
            resetGameState();
        }

        function resetGameState() {
            if (gameState.syncInterval) {
                clearInterval(gameState.syncInterval);
            }
            gameState = {
                mode: '',
                currentTeam: '',
                teams: [],
                completedSeals: [],
                startTime: null,
                currentPuzzle: null,
                isGameActive: false,
                roomId: '',
                isHost: false,
                syncInterval: null
            };
        }

        // Room Functions
        function createRoom() {
            const teamName = document.getElementById('teamName').value.trim();
            if (!teamName) {
                alert('Please enter a team name first');
                return;
            }

            const roomId = generateRoomId();
            gameState.roomId = roomId;
            gameState.isHost = true;
            gameState.currentTeam = teamName;

            // Create room data
            const roomData = {
                room: roomId,
                teams: [{
                    name: teamName, 
                    isHost: true, 
                    joinTime: Date.now(), 
                    seals: 0, 
                    finished: false,
                    time: 0
                }],
                status: 'waiting',
                host: teamName,
                created: Date.now()
            };

            localStorage.setItem(`room_${roomId}`, JSON.stringify(roomData));
            
            alert(`‚úÖ Room created successfully!`);
            showLobby();
        }

        function showJoinRoom() {
            document.getElementById('joinRoomDiv').classList.remove('hidden');
        }

        function joinViaLink() {
            const link = document.getElementById('roomLink').value.trim();
            const teamName = document.getElementById('teamName').value.trim();
            
            if (!link || !teamName) {
                alert('Please enter both room link and team name');
                return;
            }

            // Extract room ID from URL
            const urlParams = new URLSearchParams(link.split('?')[1] || '');
            const roomId = urlParams.get('room');
            
            if (!roomId) {
                alert('‚ùå Invalid room link');
                return;
            }

            const roomData = loadGameState(roomId);
            if (!roomData) {
                alert('‚ùå Room not found');
                return;
            }

            if (roomData.teams.length >= 6) {
                alert('‚ùå Room is full');
                return;
            }

            if (roomData.teams.some(t => t.name === teamName)) {
                alert('‚ùå Team name already exists');
                return;
            }

            // Join the room
            gameState.roomId = roomId;
            gameState.isHost = false;
            gameState.currentTeam = teamName;

            roomData.teams.push({
                name: teamName, 
                isHost: false, 
                joinTime: Date.now(), 
                seals: 0, 
                finished: false,
                time: 0
            });

            localStorage.setItem(`room_${roomId}`, JSON.stringify(roomData));
            
            alert(`‚úÖ Joined room successfully!`);
            showLobby();
        }

        function showLobby() {
            document.getElementById('teamSetup').style.display = 'none';
            document.getElementById('roomLobby').classList.remove('hidden');
            
            // Create share link
            const shareLink = `${window.location.origin}${window.location.pathname}?room=${gameState.roomId}`;
            document.getElementById('shareLink').textContent = shareLink;
            
            if (gameState.isHost) {
                document.getElementById('lobbyTitle').textContent = 'Game Room (Host)';
                document.getElementById('hostControls').classList.remove('hidden');
            } else {
                document.getElementById('lobbyTitle').textContent = 'Game Room';
                document.getElementById('hostControls').classList.add('hidden');
            }

            // Start syncing
            gameState.syncInterval = setInterval(syncWithRoom, 3000);
            syncWithRoom(); // Initial sync
        }

        function updateLobby(roomData) {
            // Update team count
            document.getElementById('teamCount').textContent = roomData.teams.length;

            // Update teams list
            let teamsHtml = '';
            roomData.teams.forEach(team => {
                const hostBadge = team.isHost ? ' üëë' : '';
                teamsHtml += `
                    <div class="lobby-team ${team.isHost ? 'host' : ''}">
                        <div>
                            <strong>${team.name}${hostBadge}</strong>
                            <div style="font-size: 0.9em; opacity: 0.7;">Joined ${new Date(team.joinTime).toLocaleTimeString()}</div>
                        </div>
                        <div class="status">Ready</div>
                    </div>
                `;
            });

            document.getElementById('lobbyTeams').innerHTML = teamsHtml;

            // Update start button for host
            if (gameState.isHost) {
                const startBtn = document.getElementById('startRoomGame');
                const canStart = roomData.teams.length >= 2;
                startBtn.disabled = !canStart;
                startBtn.textContent = canStart ? 'üöÄ Start Game' : 'üöÄ Start Game (Need 2+ teams)';
            }
        }

        function startRoomGame() {
            if (!gameState.isHost) return;

            const roomData = loadGameState(gameState.roomId);
            if (roomData) {
                roomData.status = 'playing';
                roomData.started = Date.now();
                localStorage.setItem(`room_${gameState.roomId}`, JSON.stringify(roomData));
                alert('üöÄ Game started! Good luck!');
            }
        }

        function startRoomGameplay() {
            if (gameState.syncInterval) {
                clearInterval(gameState.syncInterval);
            }

            gameState.startTime = Date.now();
            gameState.isGameActive = true;
            gameState.completedSeals = [];

            // Show game screen
            document.getElementById('roomLobby').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('currentTeam').textContent = gameState.currentTeam;
            document.getElementById('gameMode').textContent = 'Simple Multiplayer Competition';
            document.getElementById('leaderboard').style.display = 'block';

            renderSeals();
            startTimer();
            
            // Start room game monitoring
            gameState.syncInterval = setInterval(syncWithRoom, 5000);
        }

        function updateLeaderboard(teams) {
            // Sort teams by progress and time
            const sortedTeams = [...teams].sort((a, b) => {
                if (a.finished && !b.finished) return -1;
                if (!a.finished && b.finished) return 1;
                if (a.finished && b.finished) return a.time - b.time;
                return b.seals - a.seals || a.time - b.time;
            });

            let html = '';
            sortedTeams.forEach((team, index) => {
                const rank = index + 1;
                const timeStr = formatTime(team.time || 0);
                const statusClass = rank === 1 ? 'first' : rank === 2 ? 'second' : rank === 3 ? 'third' : '';
                const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
                const status = team.finished ? '‚úÖ Finished' : `${team.seals}/7 seals`;
                const isCurrentTeam = team.name === gameState.currentTeam;
                
                html += `
                    <div class="team-entry ${statusClass}" style="${isCurrentTeam ? 'border: 2px solid #d4af37;' : ''}">
                        <div>
                            <strong>${medal} ${team.name}${isCurrentTeam ? ' (You)' : ''}</strong>
                            <div style="font-size: 0.9em; opacity: 0.8;">${status}</div>
                        </div>
                        <div style="text-align: right;">
                            <strong>${timeStr}</strong>
                        </div>
                    </div>
                `;
            });

            document.getElementById('leaderboardContent').innerHTML = html;
        }

        function leaveRoom() {
            if (gameState.syncInterval) {
                clearInterval(gameState.syncInterval);
            }

            // Reset to main menu
            document.getElementById('roomLobby').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('teamName').value = '';
            document.getElementById('roomLink').value = '';
            document.getElementById('joinRoomDiv').classList.add('hidden');
            
            resetGameState();
        }

        function copyShareLink() {
            const link = document.getElementById('shareLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert(`üìã Room link copied to clipboard!`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`üìã Room link copied to clipboard!`);
            });
        }

        // Game Functions
        function startGame() {
            if (gameState.mode === 'room') {
                alert('Please use Create Room or Join via Link for multiplayer games');
                return;
            }

            const teamName = document.getElementById('teamName').value.trim();
            if (!teamName) {
                alert('Please enter a team name');
                return;
            }

            gameState.currentTeam = teamName;
            gameState.startTime = Date.now();
            gameState.isGameActive = true;
            gameState.completedSeals = [];

            if (gameState.mode === 'multi') {
                // Add simulated AI teams for demo
                gameState.teams = [{ name: teamName, seals: 0, time: 0, finished: false }];
                const numTeams = parseInt(document.getElementById('numTeams').value);
                
                for (let i = 2; i <= numTeams; i++) {
                    gameState.teams.push({
                        name: `Team ${i}`,
                        seals: 0,
                        time: 0,
                        finished: false
                    });
                }
                
                startAITeams();
            }

            // Show game screen
            document.getElementById('teamSetup').style.display = 'none';
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('currentTeam').textContent = teamName;
            document.getElementById('gameMode').textContent = gameState.mode === 'single' ? 'Single Group Mode' : 'vs Computer Teams';
            
            if (gameState.mode === 'multi') {
                document.getElementById('leaderboard').style.display = 'block';
            }

            renderSeals();
            startTimer();
        }

        function startAITeams() {
            gameState.teams.slice(1).forEach((team, index) => {
                const delay = Math.random() * 30000 + 15000;
                
                function simulateProgress() {
                    if (!gameState.isGameActive || team.finished) return;
                    
                    if (team.seals < 7) {
                        team.seals++;
                        team.time = Date.now() - gameState.startTime;
                        
                        if (team.seals === 7) {
                            team.finished = true;
                            team.time += Math.random() * 60000;
                        }
                        
                        updateAILeaderboard();
                        
                        if (team.seals < 7) {
                            setTimeout(simulateProgress, delay + Math.random() * 20000);
                        }
                    }
                }
                
                setTimeout(simulateProgress, delay + index * 5000);
            });
        }

        function updateAILeaderboard() {
            if (gameState.mode !== 'multi') return;

            const currentTeam = gameState.teams[0];
            currentTeam.seals = gameState.completedSeals.length;
            currentTeam.time = Date.now() - gameState.startTime;
            currentTeam.finished = gameState.completedSeals.length === 7;

            updateLeaderboard(gameState.teams);
        }

        function renderSeals() {
            let html = '';
            
            seals.forEach(seal => {
                const completed = gameState.completedSeals.includes(seal.id);
                const canOpen = seal.unlock.every(req => gameState.completedSeals.includes(req));
                const locked = !canOpen && !completed;
                
                let statusClass = '';
                if (completed) statusClass = 'completed';
                else if (locked) statusClass = 'locked';
                
                html += `
                    <div class="seal ${statusClass}" onclick="${locked ? '' : `openSeal(${seal.id})`}">
                        <div class="seal-number">${seal.id}</div>
                        <div class="seal-title">${seal.title}</div>
                        <p>${seal.description}</p>
                        ${completed ? '<div style="color: #228b22; margin-top: 10px;">‚úÖ Completed</div>' : ''}
                        ${locked ? '<div style="color: #dc3545; margin-top: 10px;">üîí Locked</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('sealsGrid').innerHTML = html;
            updateProgress();
        }

        function openSeal(sealId) {
            // Simplified - just complete the seal for demo
            if (!gameState.completedSeals.includes(sealId)) {
                gameState.completedSeals.push(sealId);
                alert(`üéâ Seal ${sealId} completed!`);
                
                renderSeals();
                
                if (gameState.mode === 'multi') {
                    updateAILeaderboard();
                } else if (gameState.mode === 'room') {
                    updateTeamProgress();
                }
                
                // Check if all seals completed
                if (gameState.completedSeals.length === 7) {
                    finishGame();
                }
            }
        }

        function finishGame() {
            gameState.isGameActive = false;
            const completionTime = Date.now() - gameState.startTime;
            const timeStr = formatTime(completionTime);
            
            let message = `<h3>üèÜ Congratulations!</h3>`;
            message += `<p><strong>Completion Time: ${timeStr}</strong></p>`;
            
            if (gameState.mode === 'room') {
                updateTeamProgress(); // Final update
            }
            
            document.getElementById('victoryMessage').innerHTML = message;
            document.getElementById('finalChallenge').style.display = 'block';
        }

        function updateProgress() {
            const progress = (gameState.completedSeals.length / 7) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${gameState.completedSeals.length}/7 Seals Broken`;
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            
            function updateTimer() {
                if (!gameState.isGameActive) return;
                
                const elapsed = Date.now() - gameState.startTime;
                timerElement.textContent = formatTime(elapsed);
                
                if (gameState.mode === 'multi') {
                    updateAILeaderboard();
                }
                
                setTimeout(updateTimer, 1000);
            }
            
            updateTimer();
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset the game?')) {
                if (gameState.mode === 'room') {
                    leaveRoom();
                } else {
                    document.getElementById('gameScreen').classList.add('hidden');
                    document.getElementById('finalChallenge').style.display = 'none';
                    document.getElementById('modeSelection').style.display = 'grid';
                    document.getElementById('teamName').value = '';
                    resetGameState();
                }
            }
        }

        // Check for room parameter on page load
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            
            if (roomId) {
                // Auto-join room from URL
                document.getElementById('roomLink').value = window.location.href;
                selectMode('room');
                showJoinRoom();
            }
        });
    </script>
</body>
</html>
